<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reportar información – Vigilantia</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
                primary: {
                  50: "#f3f1ff",
                  100: "#e9e4ff",
                  200: "#cabdff",
                  300: "#a892ff",
                  400: "#8a6eff",
                  500: "#6f4bff",
                  600: "#5b3de6",
                  700: "#4a32bf",
                  800: "#3b2999",
                  900: "#2f217a"
                }
              }
            }
          }
        };
    </script>

    <style>
      .hidden-el {
        display: none;
      }
      .step {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        user-select: none;
      }
      .node {
        height: 2rem;
        width: 2rem;
        border-radius: 9999px;
        display: grid;
        place-content: center;
        font-weight: 700;
      }
      .node-done {
        background: linear-gradient(90deg, #6f4bff, #2563eb);
        color: #fff;
      }
      .node-current {
        background: #fff;
        border: 2px solid #6f4bff;
        color: #6f4bff;
        box-shadow: 0 4px 14px rgba(111, 75, 255, 0.2);
      }
      .node-upcoming {
        background: #e5e7eb;
        color: #374151;
      }
    </style>
  </head>

  <body class="bg-slate-50 text-slate-800">
    <header class="bg-white border-b">
      <div
        class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between"
      >
        <a
          href="index.html"
          class="flex items-center gap-2"
          aria-label="Inicio"
        >
          <span
            class="inline-flex h-9 w-9 items-center justify-center rounded-xl text-white font-bold"
            style="background: linear-gradient(90deg, #6f4bff, #2563eb)"
            >V</span
          >
          <span class="font-bold">Vigilantia • Reportar</span>
        </a>
      </div>
    </header>

    <!-- Stepper -->
    <section id="stepper" class="bg-white border-b">
      <div class="max-w-3xl mx-auto px-4 py-5">
        <ol class="flex items-start justify-between text-xs sm:text-sm">
          <li id="nav1" class="step">
            <span id="node1" class="node node-current">1</span
            ><span>Datos básicos</span>
          </li>
          <li id="nav2" class="step">
            <span id="node2" class="node node-upcoming">2</span
            ><span>Detalles</span>
          </li>
          <li id="nav3" class="step">
            <span id="node3" class="node node-upcoming">3</span
            ><span>Vista previa</span>
          </li>
          <li id="nav4" class="step">
            <span id="node4" class="node node-upcoming">4</span
            ><span>Confirmación</span>
          </li>
        </ol>
        <div
          class="relative mt-3 h-1.5 rounded-full bg-slate-200 overflow-hidden"
        >
          <div
            id="bar"
            class="h-full bg-gradient-to-r from-primary-600 to-blue-600 transition-all duration-300"
            style="width: 0%"
          ></div>
        </div>
      </div>
    </section>

    <main class="max-w-3xl mx-auto px-4 py-6 space-y-8">
      <!-- Paso 1 -->
      <section id="step1" class="space-y-4">
        <form id="form1" class="grid sm:grid-cols-2 gap-4">
          <label class="text-sm"
            >Nombres *
            <input
              id="nombres"
              type="text"
              required
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
          <label class="text-sm"
            >Apellidos *
            <input
              id="apellidos"
              type="text"
              required
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
          <label class="text-sm"
            >Cédula *
            <input
              id="cedula"
              type="number"
              inputmode="numeric"
              pattern="\\d+"
              min="0"
              step="1"
              required
              class="mt-1 w-full rounded-md border p-2 appearance-none"
            />
          </label>
          <label class="text-sm"
            >Teléfono *
            <input
              id="telefono"
              type="tel"
              required
              inputmode="numeric"
              pattern="\d{10}"
              maxlength="10"
              title="Ingresa un número de 10 dígitos"
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
          <label class="text-sm sm:col-span-2"
            >Email *
            <input
              id="email"
              type="email"
              required
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
          <label class="text-sm sm:col-span-2"
            >Foto de rostro *
            <input
              id="fotoRostro"
              type="file"
              accept="image/*"
              required
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
          <div class="sm:col-span-2 flex items-center gap-2">
            <input
              id="consent"
              type="checkbox"
              required
              class="border rounded"
            />
            <span class="text-xs">
              Acepto los
              <a href="#" class="text-primary-600 underline"
                >Términos &amp; Condiciones</a
              >
              y la
              <a href="#" class="text-primary-600 underline"
                >Política de Tratamiento de Datos</a
              >.
            </span>
          </div>
          <div class="sm:col-span-2 flex justify-end pt-2">
            <button
              id="go2"
              type="button"
              class="px-4 py-2 rounded-md text-white bg-primary-600 hover:bg-primary-700"
            >
              Continuar
            </button>
          </div>
        </form>
      </section>

      <!-- Paso 2 -->
      <section id="step2" class="hidden-el space-y-4">
        <label class="text-sm"
          >Tipo de reporte *
          <select
            id="tipoReporte"
            required
            class="mt-1 w-full rounded-md border p-2"
          >
            <option value="">Seleccione</option>
            <option>INGRESO</option>
            <option>SALIDA</option>
            <option>INCIDENTE</option>
            <option>NOVEDAD</option>
            <option>PROCESO</option>
          </select>
        </label>

        <div id="bloqueIngreso" class="hidden space-y-4">
          <label class="text-sm"
            >Modalidad *
            <select
              id="ing_modalidad"
              class="mt-1 w-full rounded-md border p-2"
            >
              <option value="">Seleccione</option>
              <option>Interna</option>
              <option>Por días</option>
              <option>Tiempo completo</option>
              <option>Parcial</option>
            </select>
          </label>
          <label class="text-sm">Días de la semana *</label>
          <div class="grid grid-cols-3 sm:grid-cols-6 gap-2">
            <label class="flex items-center gap-1"
              ><input type="checkbox" value="Lunes" class="dias" />Lun</label
            >
            <label class="flex items-center gap-1"
              ><input type="checkbox" value="Martes" class="dias" />Mar</label
            >
            <label class="flex items-center gap-1"
              ><input
                type="checkbox"
                value="Miércoles"
                class="dias"
              />Mié</label
            >
            <label class="flex items-center gap-1"
              ><input type="checkbox" value="Jueves" class="dias" />Jue</label
            >
            <label class="flex items-center gap-1"
              ><input type="checkbox" value="Viernes" class="dias" />Vie</label
            >
            <label class="flex items-center gap-1"
              ><input type="checkbox" value="Sábado" class="dias" />Sáb</label
            >
          </div>
          <div class="grid grid-cols-3 gap-4">
            <label class="text-sm"
              >Salario *
              <input
                id="ing_salario"
                type="number"
                class="mt-1 w-full rounded-md border p-2"
              />
            </label>
            <label class="text-sm"
              >Moneda *
              <select id="ing_moneda" class="mt-1 w-full rounded-md border p-2">
                <option>COP</option>
                <option>USD</option>
              </select>
            </label>
            <label class="text-sm"
              >Periodicidad *
              <select
                id="ing_periodicidad"
                class="mt-1 w-full rounded-md border p-2"
              >
                <option>Mensual</option>
                <option>Quincenal</option>
                <option>Semanal</option>
              </select>
            </label>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <label class="text-sm"
              >EPS *
              <input
                id="ing_eps"
                type="text"
                class="mt-1 w-full rounded-md border p-2"
              />
            </label>
            <label class="text-sm"
              >ARL *
              <input
                id="ing_arl"
                type="text"
                class="mt-1 w-full rounded-md border p-2"
              />
            </label>
          </div>
          <label class="text-sm"
            >Fecha de inicio *
            <input
              id="ing_inicio"
              type="date"
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
        </div>

        <div id="bloqueSalida" class="hidden space-y-4">
          <label class="text-sm"
            >Fecha de salida *
            <input
              id="sal_fecha"
              type="date"
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
          <label class="text-sm"
            >Motivo *
            <select id="sal_motivo" class="mt-1 w-full rounded-md border p-2">
              <option value="">Seleccione</option>
              <option>Renuncia</option>
              <option>Mutuo acuerdo</option>
              <option>Justa causa</option>
              <option>Sin justa causa</option>
            </select>
          </label>
          <label class="text-sm"
            >Recontratable *
            <select
              id="sal_recontratable"
              class="mt-1 w-full rounded-md border p-2"
            >
              <option value="">Seleccione</option>
              <option>Sí</option>
              <option>No</option>
            </select>
          </label>
        </div>

        <div id="bloqueIncidente" class="hidden space-y-4">
          <label class="text-sm"
            >Clasificación *
            <select
              id="inc_clasificacion"
              class="mt-1 w-full rounded-md border p-2"
            >
              <option value="">Seleccione</option>
              <option>Robo</option>
              <option>Maltrato</option>
              <option>Incumplimiento</option>
              <option>Negligencia</option>
              <option>Otro</option>
            </select>
          </label>
          <label class="text-sm"
            >Severidad *
            <select
              id="inc_severidad"
              class="mt-1 w-full rounded-md border p-2"
            >
              <option value="">Seleccione</option>
              <option>Bajo</option>
              <option>Medio</option>
              <option>Alto</option>
              <option>Crítico</option>
            </select>
          </label>
          <label class="text-sm"
            >Denuncia formal *
            <select id="inc_denuncia" class="mt-1 w-full rounded-md border p-2">
              <option value="">Seleccione</option>
              <option>NO</option>
              <option>SÍ</option>
            </select>
          </label>
          <div id="inc_denuncia_detalle" class="hidden grid grid-cols-2 gap-4">
            <label class="text-sm"
              >Entidad
              <input
                id="inc_entidad"
                type="text"
                class="mt-1 w-full rounded-md border p-2"
              />
            </label>
            <label class="text-sm"
              >Radicado
              <input
                id="inc_radicado"
                type="text"
                class="mt-1 w-full rounded-md border p-2"
              />
            </label>
          </div>
          <label class="text-sm"
            >Descripción *
            <textarea
              id="inc_descripcion"
              rows="3"
              class="mt-1 w-full rounded-md border p-2"
            ></textarea>
          </label>
          <label class="text-sm"
            >Evidencias (máx 10)
            <input
              id="inc_evidencias"
              type="file"
              multiple
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
        </div>

        <div id="bloqueNovedad" class="hidden space-y-4">
          <label class="text-sm"
            >Tipo *
            <select id="nov_tipo" class="mt-1 w-full rounded-md border p-2">
              <option value="">Seleccione</option>
              <option>Cambio de horario</option>
              <option>Llamado de atención</option>
              <option>Capacitación</option>
              <option>Otra</option>
            </select>
          </label>
          <label class="text-sm"
            >Descripción *
            <textarea
              id="nov_descripcion"
              rows="3"
              class="mt-1 w-full rounded-md border p-2"
            ></textarea>
          </label>
        </div>

        <div id="bloqueProceso" class="hidden space-y-4">
          <label class="text-sm"
            >Tipo de proceso *
            <select id="pro_tipo" class="mt-1 w-full rounded-md border p-2">
              <option value="">Seleccione</option>
              <option>Postulada</option>
              <option>Entrevista</option>
              <option>Prueba</option>
              <option>Oferta en firma</option>
            </select>
          </label>
          <label class="text-sm"
            >Fuente *
            <select id="pro_fuente" class="mt-1 w-full rounded-md border p-2">
              <option value="">Seleccione</option>
              <option>Hogar</option>
              <option>Agencia</option>
              <option>Plataforma</option>
            </select>
          </label>
          <label class="text-sm"
            >Fecha próximo paso *
            <input
              id="pro_fecha"
              type="date"
              class="mt-1 w-full rounded-md border p-2"
            />
          </label>
        </div>

        <div class="flex justify-between pt-2">
          <button id="back1" type="button" class="px-4 py-2 rounded-md border">
            Atrás
          </button>
          <button
            id="go3"
            type="button"
            class="px-4 py-2 rounded-md text-white bg-primary-600 hover:bg-primary-700"
          >
            Vista previa
          </button>
        </div>
      </section>

      <!-- Paso 3 -->
      <section id="step3" class="hidden-el space-y-4">
        <div>
          <h2 class="font-semibold">JSON del reporte</h2>
          <pre
            id="preview"
            class="mt-2 bg-slate-900 text-slate-50 p-3 rounded-md overflow-auto text-xs"
          ></pre>
        </div>
        <div class="flex justify-between">
          <button id="back2" type="button" class="px-4 py-2 rounded-md border">
            Atrás
          </button>
          <button
            id="send"
            type="button"
            class="px-4 py-2 rounded-md text-white bg-primary-600 hover:bg-primary-700"
          >
            Enviar y Guardar
          </button>
        </div>
      </section>

      <!-- Paso 4 -->
      <section id="step4" class="hidden-el space-y-4 text-center">
        <p class="text-lg font-semibold">¡Gracias por tu reporte!</p>
        <p>
          Tu información nos ayuda a mejorar las condiciones laborales de las
          trabajadoras del hogar.
        </p>
        <button
          id="close"
          type="button"
          class="px-4 py-2 rounded-md text-white bg-primary-600 hover:bg-primary-700"
        >
          Cerrar
        </button>
      </section>
    </main>
    <script>
      let step = 1;
      const gcrypto = globalThis.crypto;
     const goto = (s) => {
        step = s;
        document
          .getElementById("step1")
          .classList.toggle("hidden-el", step !== 1);
        document
          .getElementById("step2")
          .classList.toggle("hidden-el", step !== 2);
        document
          .getElementById("step3")
          .classList.toggle("hidden-el", step !== 3);
        document
          .getElementById("step4")
          .classList.toggle("hidden-el", step !== 4);
        document.getElementById("node1").className =
          "node " +
          (step > 1
            ? "node-done"
            : step === 1
              ? "node-current"
              : "node-upcoming");
        document.getElementById("node2").className =
          "node " +
          (step > 2
            ? "node-done"
            : step === 2
              ? "node-current"
              : "node-upcoming");
        document.getElementById("node3").className =
          "node " +
          (step > 3
            ? "node-done"
            : step === 3
              ? "node-current"
              : "node-upcoming");
        document.getElementById("node4").className =
          "node " + (step === 4 ? "node-current" : "node-upcoming");
        document.getElementById("bar").style.width =
          step === 1
            ? "0%"
            : step === 2
              ? "33%"
              : step === 3
                ? "66%"
                : "100%";
        document
          .getElementById("stepper")
          .classList.toggle("hidden", step === 4);
      };

      // Mostrar bloque según tipo
      const tipo = document.getElementById("tipoReporte");
      const bloques = {
        INGRESO: document.getElementById("bloqueIngreso"),
        SALIDA: document.getElementById("bloqueSalida"),
        INCIDENTE: document.getElementById("bloqueIncidente"),
        NOVEDAD: document.getElementById("bloqueNovedad"),
        PROCESO: document.getElementById("bloqueProceso")
        };
      tipo.addEventListener("change", () => {
        Object.values(bloques).forEach((b) => b.classList.add("hidden"));
        if (bloques[tipo.value]) bloques[tipo.value].classList.remove("hidden");
      });

      // Denuncia formal
      const selDenuncia = document.getElementById("inc_denuncia");
      const detDenuncia = document.getElementById("inc_denuncia_detalle");
      selDenuncia.addEventListener("change", () => {
        detDenuncia.classList.toggle("hidden", selDenuncia.value !== "SÍ");
      });

      function diasSeleccionados() {
        return Array.from(document.querySelectorAll(".dias:checked")).map(
          (c) => c.value
        );
      }

      function generateUUID() {
        if (gcrypto?.randomUUID) {
          return gcrypto.randomUUID();
        }
        const bytes = new Uint8Array(16);
        if (gcrypto?.getRandomValues) {
          gcrypto.getRandomValues(bytes);
        } else {
          for (let i = 0; i < bytes.length; i++) {
            bytes[i] = Math.floor(Math.random() * 256);
          }
        }
        bytes[6] = (bytes[6] & 0x0f) | 0x40;
        bytes[8] = (bytes[8] & 0x3f) | 0x80;
        const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, "0"));
        return (
          hex.slice(0, 4).join("") +
          "-" +
          hex.slice(4, 6).join("") +
          "-" +
          hex.slice(6, 8).join("") +
          "-" +
          hex.slice(8, 10).join("") +
          "-" +
          hex.slice(10).join("")
        );
      }
      async function hashCedula(v) {␊
        if (gcrypto?.subtle?.digest) {
          const h = await gcrypto.subtle.digest(
            "SHA-256",␊
            new TextEncoder().encode(v)␊
          );␊
          return Array.from(new Uint8Array(h))␊
            .map((b) => b.toString(16).padStart(2, "0"))␊
            .join("");
        }
        let hash = 0;
        for (let i = 0; i < v.length; i++) {
          hash = (hash << 5) - hash + v.charCodeAt(i);
          hash |= 0;
        }
        return hash.toString(16);
      }
      function fileTo64(f) {
        return new Promise((res, rej) => {
          const r = new FileReader();
          r.onload = () => res(r.result);
          r.onerror = rej;
          r.readAsDataURL(f);
        });
      }

     document.getElementById("go2").addEventListener("click", () => {
        const form = document.getElementById("form1");
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }
        goto(2);
      });
      document.getElementById("back1").addEventListener("click", () => goto(1));

      document.getElementById("go3").addEventListener("click", async () => {
      const t = tipo.value;
        if (!t) {
          alert("Selecciona el tipo de reporte.");
          return;
        }
        const tel = document.getElementById("telefono").value.trim();
        if (!/^\d{10}$/.test(tel)) {
          alert("El número de teléfono debe tener exactamente 10 dígitos.");
          return;
        }
        // Validar campos según bloque
        let ok = true;
        if (t === "INGRESO") {
          if (
            !document.getElementById("ing_modalidad").value ||
            diasSeleccionados().length === 0 ||
            !document.getElementById("ing_salario").value ||
            !document.getElementById("ing_eps").value ||
            !document.getElementById("ing_arl").value ||
            !document.getElementById("ing_inicio").value
          )
            ok = false;
        }
        if (t === "SALIDA") {
          if (
            !document.getElementById("sal_fecha").value ||
            !document.getElementById("sal_motivo").value ||
            !document.getElementById("sal_recontratable").value
          )
            ok = false;
        }
        if (t === "INCIDENTE") {
          if (
            !document.getElementById("inc_clasificacion").value ||
            !document.getElementById("inc_severidad").value ||
            !document.getElementById("inc_denuncia").value ||
            !document.getElementById("inc_descripcion").value
          )
            ok = false;
        }
        if (t === "NOVEDAD") {
          if (
            !document.getElementById("nov_tipo").value ||
            !document.getElementById("nov_descripcion").value
          )
            ok = false;
        }
        if (t === "PROCESO") {
          if (
            !document.getElementById("pro_tipo").value ||
            !document.getElementById("pro_fuente").value ||
            !document.getElementById("pro_fecha").value
          )
            ok = false;
        }
        if (!ok) {
          alert("Completa los campos requeridos.");
          return;
        }
        
      const foto = document.getElementById("fotoRostro").files[0];
        if (!foto) { alert('Adjunta la foto de rostro'); return; }
        const base = {
          idReporte: generateUUID(),
          fechaHora: new Date().toISOString(),
          tipo: t,
          datosEmpleada: {
            nombres: document.getElementById("nombres").value.trim(),
            apellidos: document.getElementById("apellidos").value.trim(),
            cedulaHash: await hashCedula(
              document.getElementById("cedula").value
            ),
            telefono: document.getElementById("telefono").value.trim(),
            email: document.getElementById("email").value.trim(),
            fotoRostro: await fileTo64(foto),
          },
          detalles: {},
          evidencias: [],
        };

        if (t === "INGRESO") {
          base.detalles = {
              modalidad: document.getElementById("ing_modalidad").value,
              dias: diasSeleccionados(),
              salario: document.getElementById("ing_salario").value,
              moneda: document.getElementById("ing_moneda").value,
              periodicidad: document.getElementById("ing_periodicidad").value,
              eps: document.getElementById("ing_eps").value,
              arl: document.getElementById("ing_arl").value,
              inicio: document.getElementById("ing_inicio").value
            };
        }
        if (t === "SALIDA") {
          base.detalles = {
              fecha: document.getElementById("sal_fecha").value,
              motivo: document.getElementById("sal_motivo").value,
              recontratable: document.getElementById("sal_recontratable").value
            };
        }
        if (t === "INCIDENTE") {
          base.detalles = {
            clasificacion: document.getElementById("inc_clasificacion").value,
            severidad: document.getElementById("inc_severidad").value,
            denuncia: document.getElementById("inc_denuncia").value,
            entidad: document.getElementById("inc_entidad").value,
            radicado: document.getElementById("inc_radicado").value,
              descripcion: document
                .getElementById("inc_descripcion")
                .value.trim()
            };
          const files = Array.from(
            document.getElementById("inc_evidencias").files
          ).slice(0, 10);
          for (const f of files) {
            base.evidencias.push({
                nombre: f.name,
                tipo: f.type,
                contenido: await fileTo64(f)
              });
          }
        }
        if (t === "NOVEDAD") {
          base.detalles = {
            tipo: document.getElementById("nov_tipo").value,
              descripcion: document
                .getElementById("nov_descripcion")
                .value.trim()
            };
        }
        if (t === "PROCESO") {
          base.detalles = {
            tipoProceso: document.getElementById("pro_tipo").value,
            fuente: document.getElementById("pro_fuente").value,
            proximaFecha: document.getElementById("pro_fecha").value
            };
        }

        document.getElementById("preview").textContent = JSON.stringify(
          base,
          null,
          2
        );
        goto(3);
      });
      document.getElementById("back2").addEventListener("click", () => goto(2));

      document.getElementById("send").addEventListener("click", () => {
        alert("Reporte listo para enviar (ver consola)");
        console.log(
          "Payload JSON:",
          document.getElementById("preview").textContent
        );
        // fetch('/api/reportes',{method:'POST',body:document.getElementById("preview").textContent});
        goto(4);
        document.getElementById("back1").remove();
        document.getElementById("back2").remove();
      });

      document.getElementById("close").addEventListener("click", () => {
        window.location.href = "index.html";
        window.close();
      });

      goto(1);
    </script>
  </body>
</html>








